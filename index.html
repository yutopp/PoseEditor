<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>PoseEditor</title>

        <script src="bower_components/three.js/three.js" type="text/javascript"></script>
        <script src="build/poseeditor.js" type="text/javascript"></script>
        <script src="ext/TransformControls.js" type="text/javascript"></script>
        <script src="ext/OrbitControls.js" type="text/javascript"></script>

        <script src="http://code.jquery.com/jquery-2.1.1.js" type="text/javascript"></script>
    </head>
    <body>
        <div id="for_pose" style="width: 100%; height: 400px;"></div>

        <script type="text/javascript">
         var editor = null;

         function downloadImage() {
           // basic example
           if ( editor != null ) {
             var a = document.createElement("a");
             a.download = name;
             a.title = "download snapshot";

             var radio = document.getElementsByName("format");
             var format = "";
             for(var i=0; i<radio.length; i++) {
               if (radio[i].checked) {
                 format = radio[i].value
                 break;
               }
             }

             a.href = editor.toDataUrl(format);
             a.click();

             delete a;
           }
         }

         function loadSceneData() {
           // basic example
           if ( editor != null ) {
             var dom = document.getElementById("scene_data");
             editor.loadSceneDataFromString(dom.value);
           }
         }

         function toggleMarker() {
           // basic example
           if ( editor != null ) {
             editor.toggleMarker();
           }
         }

         function appendModel() {
           // basic example
           if ( editor != null ) {
             editor.appendModel("sport_man", function(model, error) {
               if (error) {
                 console.log("error: ", error);
               }
             });
           }
         }

         function removeModel() {
           // basic example
           if ( editor != null ) {
             editor.removeSelectedModel();
           }
         }

         function changeBGColorAndAlpha() {
           if ( editor != null ) {
             var color_dom = document.getElementById("bg_color");
             var alpha_dom = document.getElementById("bg_alpha");

             editor.setClearColor(parseInt(color_dom.value, 16), parseFloat(alpha_dom.value));
           }
         }

         function shareScene() {
           var address = 'http://yutopp.github.io/PoseEditor/';
           if ( editor != null ) {
             var target = address + '#' + encodeURIComponent(JSON.stringify(editor.getSceneInfo()));

             window.open("https://twitter.com/share?url=" + encodeURIComponent(target) + "&text=PoseEditorでポーズを作ったぞい！");
           }
         }

         $(function() {
           var config = new PoseEditor.Config();
           config.enableBackgroundAlpha = true;
           config.backgroundColorHex = 0x777777;
           config.backgroundAlpha = 1.0;
           sprite_paths = {
             normal: "images/marker.png",
             special: "images/square.png",
           };
           model_table = {
             "sport_man": {
               model_path: "models/model/model.js",
               texture_dir: "models/model/",
               ik_stop_joints: [32, 13, 1, 5, 9, 50, 12, 31, 22, 28, 25, 16, 19, 47, 41, 44, 38, 35],
             },
           };
           editor = new PoseEditor.Editor("for_pose", model_table, sprite_paths, config);
           if ( location.hash !== "" ) {
             try {
               var encoded = location.hash.slice(1);
               var json_string = decodeURIComponent(encoded);

               editor.loadSceneDataFromString(json_string);

             } catch(e) {
               console.warn(e);
             }

           } else {
             // default
             editor.appendModel("sport_man");
           }
         });
        </script>

        <textarea id="scene_data">{"camera":{"position":{"x":-30.378744633773103,"y":6.690821787723446,"z":32.822209769543434},"quaternion":{"_x":-0.06907245034341425,"_y":-0.3637574909316202,"_z":-0.027059422180314725,"_w":0.9285350115481007}},"models":{"num":2,"list":[{"name":"sport_man","position":{"x":-18.71751583786495,"y":-19.0297230961993,"z":0.28923867452510355},"q":{"_x":0,"_y":0,"_z":0,"_w":1},"joints":[{"q":{"_x":0.646233,"_y":3.3199e-10,"_z":-9.09255e-18,"_w":0.76314}},{"q":{"_x":-0.3625811666429099,"_y":-0.023856848901083354,"_z":0.6251582278785307,"_w":0.6907553390833489}},{"q":{"_x":0.17974951776829198,"_y":-0.10962059979282436,"_z":-0.11992028544882802,"_w":0.9702023294658696}},{"q":{"_x":-0.537224,"_y":-0.0809431,"_z":0.114388,"_w":0.831718}},{"q":{"_x":-0.235404,"_y":0.0177122,"_z":0.00425326,"_w":0.971727}},{"q":{"_x":-0.8340594983659633,"_y":0.12569409157086237,"_z":-0.49934827683752847,"_w":0.197982441012036}},{"q":{"_x":0.14527830651874651,"_y":0.24251962048116688,"_z":0.07837329521900609,"_w":0.9560000386680069}},{"q":{"_x":-0.53734,"_y":0.0791709,"_z":-0.115476,"_w":0.831663}},{"q":{"_x":-0.232716,"_y":0.00319407,"_z":-0.00925451,"_w":0.972495}},{"q":{"_x":0.00767915,"_y":-2.48318e-9,"_z":2.10612e-9,"_w":0.999971}},{"q":{"_x":-0.0164624,"_y":2.24799e-9,"_z":-1.86996e-9,"_w":0.999865}},{"q":{"_x":0.233231,"_y":6.47561e-10,"_z":-5.38664e-10,"_w":0.972421}},{"q":{"_x":-0.706259,"_y":0.36948,"_z":-0.494654,"_w":0.346411}},{"q":{"_x":0.1464216939116859,"_y":0.059245653474855504,"_z":0.7182379459567269,"_w":0.6776318270891885}},{"q":{"_x":0.34694231561666217,"_y":-0.3873860879540694,"_z":-0.40997103281315433,"_w":0.7493242293882575}},{"q":{"_x":0.13254405002668884,"_y":0.10795183472196393,"_z":0.6735378608965988,"_w":0.7191141954665603}},{"q":{"_x":-0.0555834,"_y":0.140396,"_z":-0.0158928,"_w":0.988406}},{"q":{"_x":0.109047,"_y":-0.0123902,"_z":-0.00404865,"_w":0.993951}},{"q":{"_x":-0.00834932,"_y":0.0251437,"_z":0.00491419,"_w":0.999637}},{"q":{"_x":0.045362,"_y":0.182065,"_z":0.0889915,"_w":0.9782}},{"q":{"_x":0.0680813,"_y":-0.00798434,"_z":-0.00519242,"_w":0.997634}},{"q":{"_x":0.0135893,"_y":0.0147897,"_z":0.00820109,"_w":0.999765}},{"q":{"_x":-0.0905757,"_y":-0.369519,"_z":0.644037,"_w":0.663677}},{"q":{"_x":0.116455,"_y":-0.000517121,"_z":-0.00401436,"_w":0.993188}},{"q":{"_x":0.0370254,"_y":-0.00358345,"_z":-0.00951937,"_w":0.999263}},{"q":{"_x":-0.0345541,"_y":0.0610855,"_z":-0.0174521,"_w":0.997382}},{"q":{"_x":0.0991333,"_y":-0.00557081,"_z":-0.00281954,"_w":0.995055}},{"q":{"_x":-0.00297076,"_y":0.0117477,"_z":0.00445022,"_w":0.999917}},{"q":{"_x":0.000169169,"_y":-0.0726416,"_z":0.213571,"_w":0.974223}},{"q":{"_x":0.0995171,"_y":0.00174617,"_z":0.00427811,"_w":0.995025}},{"q":{"_x":0.0160516,"_y":-0.00427745,"_z":-0.00808524,"_w":0.999829}},{"q":{"_x":-0.706259,"_y":-0.36948,"_z":0.494654,"_w":0.346411}},{"q":{"_x":0.339406791691741,"_y":0.5429178456913115,"_z":0.5737407390089966,"_w":-0.5107492603859892}},{"q":{"_x":0.22068015125961915,"_y":-0.2626152835889347,"_z":-0.3151426972359945,"_w":0.884883361830449}},{"q":{"_x":0.132544,"_y":-0.107952,"_z":-0.673538,"_w":0.719114}},{"q":{"_x":0.045362,"_y":-0.182065,"_z":-0.0889915,"_w":0.9782}},{"q":{"_x":0.0680813,"_y":0.00798434,"_z":0.00519242,"_w":0.997634}},{"q":{"_x":0.0135893,"_y":-0.0147897,"_z":-0.00820109,"_w":0.999765}},{"q":{"_x":-0.0555834,"_y":-0.140396,"_z":0.0158928,"_w":0.988406}},{"q":{"_x":0.109047,"_y":0.0123902,"_z":0.00404865,"_w":0.993951}},{"q":{"_x":-0.00834932,"_y":-0.0251437,"_z":-0.00491419,"_w":0.999637}},{"q":{"_x":0.000169169,"_y":0.0726416,"_z":-0.213571,"_w":0.974223}},{"q":{"_x":0.0995171,"_y":-0.00174617,"_z":-0.00427811,"_w":0.995025}},{"q":{"_x":0.0160516,"_y":0.00427745,"_z":0.00808524,"_w":0.999829}},{"q":{"_x":-0.0345541,"_y":-0.0610855,"_z":0.0174521,"_w":0.997382}},{"q":{"_x":0.0991333,"_y":0.00557081,"_z":0.00281954,"_w":0.995055}},{"q":{"_x":-0.00297076,"_y":-0.0117477,"_z":-0.00445022,"_w":0.999917}},{"q":{"_x":-0.0914642,"_y":0.3693,"_z":-0.645632,"_w":0.662126}},{"q":{"_x":0.116452,"_y":0.00100563,"_z":0.00462528,"_w":0.993185}},{"q":{"_x":0.0370136,"_y":0.00370355,"_z":0.00985419,"_w":0.999259}},{"q":{"_x":-0.16236,"_y":-8.74468e-10,"_z":9.42199e-10,"_w":0.986732}},{"q":{"_x":0.0247222,"_y":3.1436e-10,"_z":-3.17835e-10,"_w":0.999694}}]},{"name":"sport_man","position":{"x":5.471273861729502,"y":-17.20807917718551,"z":-0.22309866712336535},"q":{"_x":0,"_y":0,"_z":0,"_w":1},"joints":[{"q":{"_x":0.646233,"_y":3.3199e-10,"_z":-9.09255e-18,"_w":0.76314}},{"q":{"_x":-0.9891,"_y":-0.137045,"_z":0.0365621,"_w":0.0395378}},{"q":{"_x":0.0766249,"_y":-0.000752783,"_z":-0.0000575433,"_w":0.99706}},{"q":{"_x":-0.537224,"_y":-0.0809431,"_z":0.114388,"_w":0.831718}},{"q":{"_x":-0.235404,"_y":0.0177122,"_z":0.00425326,"_w":0.971727}},{"q":{"_x":-0.9891,"_y":0.137045,"_z":-0.0365621,"_w":0.0395378}},{"q":{"_x":0.0770293,"_y":0.00276874,"_z":0.000210752,"_w":0.997025}},{"q":{"_x":-0.53734,"_y":0.0791709,"_z":-0.115476,"_w":0.831663}},{"q":{"_x":-0.232716,"_y":0.00319407,"_z":-0.00925451,"_w":0.972495}},{"q":{"_x":0.00767915,"_y":-2.48318e-9,"_z":2.10612e-9,"_w":0.999971}},{"q":{"_x":-0.0164624,"_y":2.24799e-9,"_z":-1.86996e-9,"_w":0.999865}},{"q":{"_x":0.233231,"_y":6.47561e-10,"_z":-5.38664e-10,"_w":0.972421}},{"q":{"_x":-0.706259,"_y":0.36948,"_z":-0.494654,"_w":0.346411}},{"q":{"_x":-0.028473761768901252,"_y":0.13692105701152166,"_z":0.7432364887833371,"_w":0.6542487224126553}},{"q":{"_x":0.5551244439286387,"_y":-0.44794764728119485,"_z":-0.35533854821084276,"_w":0.6040813465118521}},{"q":{"_x":0.1325440230902243,"_y":0.10795187139112115,"_z":0.6735380275215876,"_w":0.7191140388620864}},{"q":{"_x":-0.0555834,"_y":0.140396,"_z":-0.0158928,"_w":0.988406}},{"q":{"_x":0.109047,"_y":-0.0123902,"_z":-0.00404865,"_w":0.993951}},{"q":{"_x":-0.00834932,"_y":0.0251437,"_z":0.00491419,"_w":0.999637}},{"q":{"_x":0.045362,"_y":0.182065,"_z":0.0889915,"_w":0.9782}},{"q":{"_x":0.0680813,"_y":-0.00798434,"_z":-0.00519242,"_w":0.997634}},{"q":{"_x":0.0135893,"_y":0.0147897,"_z":0.00820109,"_w":0.999765}},{"q":{"_x":-0.0905757,"_y":-0.369519,"_z":0.644037,"_w":0.663677}},{"q":{"_x":0.116455,"_y":-0.000517121,"_z":-0.00401436,"_w":0.993188}},{"q":{"_x":0.0370254,"_y":-0.00358345,"_z":-0.00951937,"_w":0.999263}},{"q":{"_x":-0.0345541,"_y":0.0610855,"_z":-0.0174521,"_w":0.997382}},{"q":{"_x":0.0991333,"_y":-0.00557081,"_z":-0.00281954,"_w":0.995055}},{"q":{"_x":-0.00297076,"_y":0.0117477,"_z":0.00445022,"_w":0.999917}},{"q":{"_x":0.000169169,"_y":-0.0726416,"_z":0.213571,"_w":0.974223}},{"q":{"_x":0.0995171,"_y":0.00174617,"_z":0.00427811,"_w":0.995025}},{"q":{"_x":0.0160516,"_y":-0.00427745,"_z":-0.00808524,"_w":0.999829}},{"q":{"_x":-0.706259,"_y":-0.36948,"_z":0.494654,"_w":0.346411}},{"q":{"_x":-0.02888032284595513,"_y":0.13114084143484284,"_z":0.7331196049565324,"_w":-0.6667110704708995}},{"q":{"_x":-0.37477968461888417,"_y":-0.3755875846355964,"_z":-0.3718470544460172,"_w":-0.7617111804118339}},{"q":{"_x":0.132544,"_y":-0.107952,"_z":-0.673538,"_w":0.719114}},{"q":{"_x":0.045362,"_y":-0.182065,"_z":-0.0889915,"_w":0.9782}},{"q":{"_x":0.0680813,"_y":0.00798434,"_z":0.00519242,"_w":0.997634}},{"q":{"_x":0.0135893,"_y":-0.0147897,"_z":-0.00820109,"_w":0.999765}},{"q":{"_x":-0.0555834,"_y":-0.140396,"_z":0.0158928,"_w":0.988406}},{"q":{"_x":0.109047,"_y":0.0123902,"_z":0.00404865,"_w":0.993951}},{"q":{"_x":-0.00834932,"_y":-0.0251437,"_z":-0.00491419,"_w":0.999637}},{"q":{"_x":0.000169169,"_y":0.0726416,"_z":-0.213571,"_w":0.974223}},{"q":{"_x":0.0995171,"_y":-0.00174617,"_z":-0.00427811,"_w":0.995025}},{"q":{"_x":0.0160516,"_y":0.00427745,"_z":0.00808524,"_w":0.999829}},{"q":{"_x":-0.0345541,"_y":-0.0610855,"_z":0.0174521,"_w":0.997382}},{"q":{"_x":0.0991333,"_y":0.00557081,"_z":0.00281954,"_w":0.995055}},{"q":{"_x":-0.00297076,"_y":-0.0117477,"_z":-0.00445022,"_w":0.999917}},{"q":{"_x":-0.0914642,"_y":0.3693,"_z":-0.645632,"_w":0.662126}},{"q":{"_x":0.116452,"_y":0.00100563,"_z":0.00462528,"_w":0.993185}},{"q":{"_x":0.0370136,"_y":0.00370355,"_z":0.00985419,"_w":0.999259}},{"q":{"_x":-0.16236,"_y":-8.74468e-10,"_z":9.42199e-10,"_w":0.986732}},{"q":{"_x":0.0247222,"_y":3.1436e-10,"_z":-3.17835e-10,"_w":0.999694}}]}]}}</textarea>
        <input type="button" value="シーンのロード" onClick="loadSceneData()">
        <input type="button" value="Twitterでシーンを共有" onClick="shareScene()">

        <br>

        <label><input type="radio" name="format" value="png" checked>PNG</label>
        <label><input type="radio" name="format" value="jpeg">JPEG</label>
        <label><input type="radio" name="format" value="json">JSON</label>
        <input type="button" value="ダウンロード" onClick="downloadImage()">

        <br>

        <label><input type="checkbox" id="toggle_marker" onClick="toggleMarker()" checked>マーカー</label>

        <br>
        <input type="button" value="モデルを追加" onClick="appendModel()">
        <input type="button" value="選択しているモデルを削除" onClick="removeModel()">

        <br>
        <label>色<input type="text" id="bg_color" value="0x777777" onChange="changeBGColorAndAlpha()"></label>
        <label>アルファ<input type="text" id="bg_alpha" value="1.0" onChange="changeBGColorAndAlpha<script src="
    </body>
</html>
